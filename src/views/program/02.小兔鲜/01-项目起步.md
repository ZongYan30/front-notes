# uni-app åŸºç¡€ {ignore}

# 1.åˆ›å»ºé¡¹ç›® {ignore}

**uni-app æ”¯æŒä¸¤ç§æ–¹å¼åˆ›å»ºé¡¹ç›®ï¼š**

1. é€šè¿‡ HBuilderX åˆ›å»ºï¼ˆéœ€å®‰è£… HBuilderX ç¼–è¾‘å™¨ï¼‰
2. é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºï¼ˆéœ€å®‰è£… NodeJS ç¯å¢ƒï¼‰

## 1.1 HBuilderX åˆ›å»º uni-app é¡¹ç›®

**1.ä¸‹è½½å®‰è£… HbuilderX ç¼–è¾‘å™¨**

**2.é€šè¿‡ HbuilderX åˆ›å»º uni-app vue3 é¡¹ç›®**

**3.å®‰è£… uni-app vue3 ç¼–è¯‘å™¨æ’ä»¶**

**4.ç¼–è¯‘æˆå¾®ä¿¡å°ç¨‹åºç«¯ä»£ç **

**5.å¼€å¯æœåŠ¡ç«¯å£**

**å°æŠ€å·§åˆ†äº«ï¼šæ¨¡æ‹Ÿå™¨çª—å£åˆ†ç¦»å’Œç½®é¡¶**

**HBuildeX å’Œ å¾®ä¿¡å¼€å‘è€…å·¥å…· å…³ç³»**

::: tip æ¸©é¦¨æç¤º
[HBuildeX](https://www.dcloud.io/hbuilderx.html) å’Œ [uni-app](https://uniapp.dcloud.net.cn/) éƒ½å±äº [DCloud](https://dcloud.io) å…¬å¸çš„äº§å“ã€‚
:::

## 1.2 pages.json å’Œ tabBar æ¡ˆä¾‹

ç›®å½•ç»“æ„

```sh {1,4,9,10}
â”œâ”€pages            ä¸šåŠ¡é¡µé¢æ–‡ä»¶å­˜æ”¾çš„ç›®å½•
â”‚  â””â”€index
â”‚     â””â”€index.vue  indexé¡µé¢
â”œâ”€static           å­˜æ”¾åº”ç”¨å¼•ç”¨çš„æœ¬åœ°é™æ€èµ„æºçš„ç›®å½•(æ³¨æ„ï¼šé™æ€èµ„æºåªèƒ½å­˜æ”¾äºæ­¤)
â”œâ”€unpackage        éå·¥ç¨‹ä»£ç ï¼Œä¸€èˆ¬å­˜æ”¾è¿è¡Œæˆ–å‘è¡Œçš„ç¼–è¯‘ç»“æœ
â”œâ”€index.html       H5ç«¯é¡µé¢
â”œâ”€main.js          Vueåˆå§‹åŒ–å…¥å£æ–‡ä»¶
â”œâ”€App.vue          é…ç½®Appå…¨å±€æ ·å¼ã€ç›‘å¬åº”ç”¨ç”Ÿå‘½å‘¨æœŸ
â”œâ”€pages.json       **é…ç½®é¡µé¢è·¯ç”±ã€å¯¼èˆªæ ã€tabBarç­‰é¡µé¢ç±»ä¿¡æ¯**
â”œâ”€manifest.json    **é…ç½®appid**ã€åº”ç”¨åç§°ã€logoã€ç‰ˆæœ¬ç­‰æ‰“åŒ…ä¿¡æ¯
â””â”€uni.scss         uni-appå†…ç½®çš„å¸¸ç”¨æ ·å¼å˜é‡
```

pages.json:ç”¨äºé…ç½®é¡µé¢è·¯ç”±ã€å¯¼èˆªæ ã€tabBar ç­‰é¡µé¢ç±»ä¿¡æ¯

ä»£ç :

```json
{
  // é¡µé¢è·¯ç”±
  "pages": [
    {
      "path": "pages/index/index",
      // é¡µé¢æ ·å¼é…ç½®
      "style": {
        "navigationBarTitleText": "é¦–é¡µ"
      }
    },
    {
      "path": "pages/my/my",
      "style": {
        "navigationBarTitleText": "æˆ‘çš„"
      }
    }
  ],
  // å…¨å±€æ ·å¼é…ç½®
  "globalStyle": {
    "navigationBarTextStyle": "white",
    "navigationBarTitleText": "uni-app",
    "navigationBarBackgroundColor": "#27BA9B",
    "backgroundColor": "#F8F8F8"
  },
  // tabBar é…ç½®
  "tabBar": {
    "selectedColor": "#27BA9B",
    "list": [
      {
        "pagePath": "pages/index/index",
        "text": "é¦–é¡µ",
        "iconPath": "static/tabs/home_default.png",
        "selectedIconPath": "static/tabs/home_selected.png"
      },
      {
        "pagePath": "pages/my/my",
        "text": "æˆ‘çš„",
        "iconPath": "static/tabs/user_default.png",
        "selectedIconPath": "static/tabs/user_selected.png"
      }
    ]
  }
}
```

## 1.3 uni-app å’ŒåŸç”Ÿå°ç¨‹åºåŒºåˆ«

**å¼€å‘åŒºåˆ«**

uni-app é¡¹ç›®æ¯ä¸ªé¡µé¢æ˜¯ä¸€ä¸ª `.vue` æ–‡ä»¶ï¼Œæ•°æ®ç»‘å®šåŠäº‹ä»¶å¤„ç†åŒ `Vue.js` è§„èŒƒï¼š

1. å±æ€§ç»‘å®š `src="{ { url }}"` å‡çº§æˆ `:src="url"`
2. äº‹ä»¶ç»‘å®š `bindtap="eventName"` å‡çº§æˆ `@tap="eventName"`ï¼Œ**æ”¯æŒï¼ˆï¼‰ä¼ å‚**
3. æ”¯æŒ Vue å¸¸ç”¨**æŒ‡ä»¤** `v-for`ã€`v-if`ã€`v-show`ã€`v-model` ç­‰

**å…¶ä»–åŒºåˆ«è¡¥å……**

1. è°ƒç”¨æ¥å£èƒ½åŠ›ï¼Œ**å»ºè®®å‰ç¼€** `wx` æ›¿æ¢ä¸º `uni` ï¼Œå…»æˆå¥½ä¹ æƒ¯ï¼Œ**æ”¯æŒå¤šç«¯å¼€å‘**ã€‚
2. `<style>` é¡µé¢æ ·å¼ä¸éœ€è¦å†™ `scoped`ï¼Œå°ç¨‹åºæ˜¯å¤šé¡µé¢åº”ç”¨ï¼Œ**é¡µé¢æ ·å¼è‡ªåŠ¨éš”ç¦»**ã€‚
3. **ç”Ÿå‘½å‘¨æœŸåˆ†ä¸‰éƒ¨åˆ†**ï¼šåº”ç”¨ç”Ÿå‘½å‘¨æœŸ(å°ç¨‹åº)ï¼Œé¡µé¢ç”Ÿå‘½å‘¨æœŸ(å°ç¨‹åº)ï¼Œç»„ä»¶ç”Ÿå‘½å‘¨æœŸ(Vue)

## 1.4 æ¡ˆä¾‹:è½®æ’­å›¾ä¸é¢„è§ˆå›¾ç‰‡

**ä¸»è¦åŠŸèƒ½**

1. æ»‘åŠ¨è½®æ’­å›¾
2. ç‚¹å‡»å¤§å›¾é¢„è§ˆ

**å‚è€ƒä»£ç **

```vue
<template>
  <swiper class="banner" indicator-dots circular :autoplay="false">
    <swiper-item v-for="item in pictures" :key="item.id">
      <image @tap="onPreviewImage(item.url)" :src="item.url"></image>
    </swiper-item>
  </swiper>
</template>

<script>
export default {
  data() {
    return {
      // è½®æ’­å›¾æ•°æ®
      pictures: [
        {
          id: "1",
          url: "https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/goods_preview_1.jpg",
        },
        {
          id: "2",
          url: "https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/goods_preview_2.jpg",
        },
        {
          id: "3",
          url: "https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/goods_preview_3.jpg",
        },
        {
          id: "4",
          url: "https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/goods_preview_4.jpg",
        },
        {
          id: "5",
          url: "https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/uploads/goods_preview_5.jpg",
        },
      ],
    };
  },
  methods: {
    onPreviewImage(url) {
      // å¤§å›¾é¢„è§ˆ
      uni.previewImage({
        urls: this.pictures.map((v) => v.url), //æ”¾ç½®é¢„è§ˆçš„æ•°ç»„
        current: url, //å½“å‰é¢„è§ˆçš„url
      });
    },
  },
};
</script>

<style>
.banner,
.banner image {
  width: 750rpx;
  height: 750rpx;
}
</style>
```

## 1.5 å‘½ä»¤è¡Œåˆ›å»º uni-app é¡¹ç›®

vue3 + ts ç‰ˆ

```sh [github]
# é€šè¿‡ npx ä» github ä¸‹è½½
npx degit dcloudio/uni-preset-vue#vite-ts é¡¹ç›®åç§°
```

```sh [ğŸ‘‰å›½å†… gitee]
# é€šè¿‡ git ä» gitee å…‹éš†ä¸‹è½½ (ğŸ‘‰å¤‡ç”¨åœ°å€)
git clone -b vite-ts https://gitee.com/dcloud/uni-preset-vue.git
```

**ç¼–è¯‘å’Œè¿è¡Œ uni-app é¡¹ç›®**

1. å®‰è£…ä¾èµ–

   ```SH
   pnpm install
   ```

2. ç¼–è¯‘æˆå¾®ä¿¡å°ç¨‹åº

   ```SH
   pnpm dev:mp-weixin
   ```

3. å¯¼å…¥å¾®ä¿¡å¼€å‘è€…å·¥å…·

   æ¸©é¦¨æç¤º
   ç¼–è¯‘æˆ H5 ç«¯å¯è¿è¡Œ `pnpm dev:h5` é€šè¿‡æµè§ˆå™¨é¢„è§ˆé¡¹ç›®ã€‚

## 1.6 ç”¨ VS Code å¼€å‘ uni-app é¡¹ç›®

**VS Code å¼€å‘é…ç½®**

- ğŸ‘‰ å‰ç½®å·¥ä½œï¼šå®‰è£… Vue3 æ’ä»¶ï¼Œ[ç‚¹å‡»æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/guide/typescript/overview.html#ide-support)

  - å®‰è£… **Vue Language Features (Volar)** ï¼šVue3 è¯­æ³•æç¤ºæ’ä»¶
  - å®‰è£… **TypeScript Vue Plugin (Volar)** ï¼šVue3+TS æ’ä»¶
  - **å·¥ä½œåŒºç¦ç”¨** Vue2 çš„ Vetur æ’ä»¶(Vue3 æ’ä»¶å’Œ Vue2 å†²çª)
  - **å·¥ä½œåŒºç¦ç”¨** @builtin typescript æ’ä»¶ï¼ˆç¦ç”¨åå¼€å¯ Vue3 çš„ TS æ‰˜ç®¡æ¨¡å¼ï¼‰

- ğŸ‘‰ å®‰è£… uni-app å¼€å‘æ’ä»¶

  - **uni-create-view** ï¼šå¿«é€Ÿåˆ›å»º uni-app é¡µé¢
  - **uni-helper uni-app** ï¼šä»£ç æç¤º
  - **uniapp å°ç¨‹åºæ‰©å±•** ï¼šé¼ æ ‡æ‚¬åœæŸ¥æ–‡æ¡£

- ğŸ‘‰ TS ç±»å‹æ ¡éªŒ

  - å®‰è£… **ç±»å‹å£°æ˜æ–‡ä»¶**

    ```sh
    pnpm i -D miniprogram-api-typings @uni-helper/uni-app-types
    ```

  - é…ç½® `tsconfig.json`

- ğŸ‘‰ JSON æ³¨é‡Šé—®é¢˜

  - è®¾ç½®æ–‡ä»¶å…³è”ï¼ŒæŠŠ `manifest.json` å’Œ `pages.json` è®¾ç½®ä¸º `jsonc`

`tsconfig.json` å‚è€ƒ

```json {11,12,14-15,18-22}
// tsconfig.json
{
  "extends": "@vue/tsconfig/tsconfig.json",
  "compilerOptions": {
    "sourceMap": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "lib": ["esnext", "dom"],
    // ç±»å‹å£°æ˜æ–‡ä»¶
    "types": [
      "@dcloudio/types", // uni-app API ç±»å‹
      "miniprogram-api-typings", // åŸç”Ÿå¾®ä¿¡å°ç¨‹åºç±»å‹
      "@uni-helper/uni-app-types" // uni-app ç»„ä»¶ç±»å‹
    ]
  },
  // vue ç¼–è¯‘å™¨ç±»å‹ï¼Œæ ¡éªŒæ ‡ç­¾ç±»å‹
  "vueCompilerOptions": {
    // åŸé…ç½® `experimentalRuntimeMode` ç°è°ƒæ•´ä¸º `nativeTags`
    "nativeTags": ["block", "component", "template", "slot"] // [!code ++]
    //"experimentalRuntimeMode": "runtime-uni-app" // [!code --]
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"]
}
```

**å·¥ä½œåŒºè®¾ç½®å‚è€ƒ**

```json
// .vscode/settings.json
{
  // åœ¨ä¿å­˜æ—¶æ ¼å¼åŒ–æ–‡ä»¶
  "editor.formatOnSave": true,
  // æ–‡ä»¶æ ¼å¼åŒ–é…ç½®
  "[json]": {
    "editor.defaultFormatter": "esbenp.prettier-vscode"
  },
  // é…ç½®è¯­è¨€çš„æ–‡ä»¶å…³è”
  "files.associations": {
    "pages.json": "jsonc", // pages.json å¯ä»¥å†™æ³¨é‡Š
    "manifest.json": "jsonc" // manifest.json å¯ä»¥å†™æ³¨é‡Š
  }
}
```

danger ç‰ˆæœ¬å‡çº§

- åŸä¾èµ– `@types/wechat-miniprogram` ç°è°ƒæ•´ä¸º [miniprogram-api-typings](https://github.com/wechat-miniprogram/api-typings)ã€‚
- åŸé…ç½® `experimentalRuntimeMode` ç°è°ƒæ•´ä¸º `nativeTags`ã€‚

**è¿™ä¸€æ­¥å¤„ç†å¾ˆå…³é”®ï¼Œå¦åˆ™ TS é¡¹ç›®æ— æ³•æ ¡éªŒç»„ä»¶å±æ€§ç±»å‹ã€‚**

## 1.7 é…ç½® eslint/prettier

**å®‰è£… eslint å’Œ prettier**

```sh
pnpm i -D eslint prettier eslint-plugin-vue @vue/eslint-config-prettier @vue/eslint-config-typescript @rushstack/eslint-patch @vue/tsconfig
```

**æ ¹ç›®å½•ä¸‹æ–°å»º`.eslintrc.cjs`æ–‡ä»¶**

```js
/* eslint-env node */
require("@rushstack/eslint-patch/modern-module-resolution");

module.exports = {
  root: true,
  extends: [
    "plugin:vue/vue3-essential",
    "eslint:recommended",
    "@vue/eslint-config-typescript",
    "@vue/eslint-config-prettier",
  ],
  // å°ç¨‹åºå…¨å±€å˜é‡
  globals: {
    uni: true,
    wx: true,
    WechatMiniprogram: true,
    getCurrentPages: true,
    getApp: true,
    UniApp: true,
    UniHelper: true,
    App: true,
    Page: true,
    Component: true,
    AnyObject: true,
  },
  parserOptions: {
    ecmaVersion: "latest",
  },
  rules: {
    "prettier/prettier": [
      "warn",
      {
        singleQuote: true,
        semi: false,
        printWidth: 100,
        trailingComma: "all",
        endOfLine: "auto",
      },
    ],
    "vue/multi-word-component-names": ["off"],
    "vue/no-setup-props-destructure": ["off"],
    "vue/no-deprecated-html-element-is": ["off"],
    "@typescript-eslint/no-unused-vars": ["off"],
  },
};
```

**æ ¹ç›®å½•æ–°å»º`prettierrc.cjs`**

```ts
{
  "singleQuote": true,
  "semi": false,
  "printWidth": 100,
  "trailingComma": "all",
  "endOfLine": "auto"
}

```

**é…ç½® package.json**

```json
{
  "script": {
    // ... çœç•¥ ...
    "lint": "eslint . --ext .vue,.js,.ts --fix --ignore-path .gitignore"
  }
}
```

è¿è¡Œ

```sh
pnpm lint
```

## 1.8 é…ç½® husky å’Œ lint-staged

**å®‰è£…å¹¶åˆå§‹åŒ–**

```sh
pnpm dlx husky-init		//å®‰è£…åˆå§‹åŒ–husky
pnpm i -D lint-staged	//å®‰è£…lint-staged
```

**é…ç½® package.json**

```json
{
  "script": {
    // ... çœç•¥ ...
    "lint-staged": "lint-staged"
  },
  "lint-staged": {
    "*.{vue,ts,js}": ["eslint --fix"]
  }
}
```

**ä¿®æ”¹ husky çš„ pre-commit æ–‡ä»¶**

```sh
npm run lint-staged
```

# 2.æ‹‰å–å°å…”é²œæ¨¡æ¿ä»£ç 

æ¨¡æ¿å·²ç»å†…ç½®äº† 4 ä¸ª tabbar,å’Œ eslint/prettier/husky

```sh
git clone -b template https://gitee.com/heima-fe/uniapp-shop-vue3-ts.git é¡¹ç›®åç§°
pnpm i
pnpm dev:mp-weixin
```

**æ³¨æ„ï¼šéœ€è¦è‡ªå·±æ·»åŠ  appid**

# 3.å¼•å…¥ uni-ui

```sh
pnpm i @dcloudio/uni-ui
```

**é…ç½®è‡ªåŠ¨å¯¼å…¥ç»„ä»¶**

```ts
// pages.json
{
  // ç»„ä»¶è‡ªåŠ¨å¯¼å…¥
  "easycom": {
    "autoscan": true,
    "custom": {
      // uni-ui è§„åˆ™å¦‚ä¸‹é…ç½®
      "^uni-(.*)": "@dcloudio/uni-ui/lib/uni-$1/uni-$1.vue"
    }
  },
  "pages": [
    // â€¦çœç•¥
  ]
}
```

**å®‰è£…ç±»å‹å£°æ˜æ–‡ä»¶**

> ç°åœ¨çš„ uni-ui å·²ç»è‡ªå·±å‘å¸ƒäº† TS ç±»å‹å£°æ˜æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ç”¨é…ç½®äº†ã€‚

```sh
pnpm i -D @uni-helper/uni-ui-types
```

**é…ç½®ç±»å‹å£°æ˜æ–‡ä»¶**

```sh
// tsconfig.json
{
  "compilerOptions": {
    // ...
    "types": [
      "@dcloudio/types", // uni-app API ç±»å‹
      "miniprogram-api-typings", // åŸç”Ÿå¾®ä¿¡å°ç¨‹åºç±»å‹
      "@uni-helper/uni-app-types", // uni-app ç»„ä»¶ç±»å‹
      "@uni-helper/uni-ui-types" // uni-ui ç»„ä»¶ç±»å‹
    ]
  },
  // vue ç¼–è¯‘å™¨ç±»å‹ï¼Œæ ¡éªŒæ ‡ç­¾ç±»å‹
  "vueCompilerOptions": {
    "nativeTags": ["block", "component", "template", "slot"]
  }
}
```

# 4.é…ç½® pinia

> åœ¨å°ç¨‹åºä¸­ï¼Œæ˜¯æ²¡æœ‰ç½‘é¡µç«¯çš„ Localstorage å¯¹è±¡ API çš„ï¼Œæ‰€ä»¥éœ€è¦è°ƒæ•´ä¸€ä¸‹å°ç¨‹åºä¸­çš„æŒä¹…åŒ–æ’ä»¶çš„ APIã€‚

å®‰è£… pinia

```sh
pnpm i pinia 						//å®‰è£…pinia
pnpm i pinia-plugin-persistedstate  //piniaæŒä¹…åŒ–
```

stores/index.ts

```ts
import { createPinia } from "pinia";
import persist from "pinia-plugin-persistedstate";

// åˆ›å»º pinia å®ä¾‹
const pinia = createPinia();
// ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨æ’ä»¶
pinia.use(persist);

// é»˜è®¤å¯¼å‡ºï¼Œç»™ main.ts ä½¿ç”¨
export default pinia;

// æ¨¡å—ç»Ÿä¸€å¯¼å‡º
export * from "./modules/member";
```

main.ts

```ts
import { createSSRApp } from "vue";
import pinia from "./stores";

import App from "./App.vue";
export function createApp() {
  const app = createSSRApp(App);

  app.use(pinia);
  return {
    app,
  };
}
```

stores/module/member.ts

```ts
import { defineStore } from "pinia";
import { ref } from "vue";

// å®šä¹‰ Store
export const useMemberStore = defineStore(
  "member",
  () => {
    // ä¼šå‘˜ä¿¡æ¯
    const profile = ref<any>();

    // ä¿å­˜ä¼šå‘˜ä¿¡æ¯ï¼Œç™»å½•æ—¶ä½¿ç”¨
    const setProfile = (val: any) => {
      profile.value = val;
    };

    // æ¸…ç†ä¼šå‘˜ä¿¡æ¯ï¼Œé€€å‡ºæ—¶ä½¿ç”¨
    const clearProfile = () => {
      profile.value = undefined;
    };

    // è®°å¾— return
    return {
      profile,
      setProfile,
      clearProfile,
    };
  },
  // TODO: æŒä¹…åŒ–
  {
    persist: {
      storage: {
        setItem(key: string, value: string) {
          uni.setStorageSync(key, value);
        },
        getItem(key: string) {
          return uni.getStorageSync(key);
        },
      },
    },
  }
);
```

å¤šç«¯çš„æŒä¹…åŒ– API

```ts
// ç½‘é¡µç«¯API
localStorage.setItem()
localStorage.getItem()

å¤šç«¯æŒä¹…åŒ– API
// å…¼å®¹å¤šç«¯API
uni.setStorageSync()
uni.getStorageSync()
```

# 5.é…ç½®è¯·æ±‚å·¥å…·

## 5.1 è¯·æ±‚æ‹¦æˆªå™¨--é…ç½® baseUrl å’Œ header

> 1. æ‹¼æ¥åŸºç¡€åœ°å€
> 2. è®¾ç½®è¶…æ—¶æ—¶é—´
> 3. æ·»åŠ è¯·æ±‚å¤´æ ‡è¯†
> 4. æ·»åŠ  token

src/utils/http/request.ts

> uni.addInterceptor(api,config) å¯ä»¥æ‹¦æˆª uni çš„ apiã€‚

```ts
// è¯·æ±‚åŸºåœ°å€
const baseURL = "https://pcapi-xiaotuxian-front-devtest.itheima.net";

// æ‹¦æˆªå™¨é…ç½®
const httpInterceptor = {
  // æ‹¦æˆªè¯·æ±‚ options:æ‹¦æˆªè¿™ä¸€æ¬¡è¯·æ±‚çš„è¯·æ±‚å‚æ•°ï¼Œç›¸å½“äºaxiosè¯·æ±‚æ‹¦æˆªå™¨çš„congig
  invoke(options: UniApp.RequestOptions) {
    // 1. é http å¼€å¤´éœ€æ‹¼æ¥åœ°å€
    if (!options.url.startsWith("http")) {
      options.url = baseURL + options.url;
    }
    // 2. è¯·æ±‚è¶…æ—¶
    options.timeout = 10000;
    // 3. æ·»åŠ å°ç¨‹åºç«¯è¯·æ±‚å¤´æ ‡è¯†
    options.header = {
      "source-client": "miniapp",
      ...options.header,
    };
    // 4. æ·»åŠ  token è¯·æ±‚å¤´æ ‡è¯†
    const memberStore = useMemberStore();
    const token = memberStore.profile?.token;
    if (token) {
      options.header.Authorization = token;
    }
  },
};

// æ‹¦æˆª request è¯·æ±‚
uni.addInterceptor("request", httpInterceptor); //ç›¸å½“äºæ‹¦æˆªæ‰€æœ‰çš„uni.request
// æ‹¦æˆª uploadFile æ–‡ä»¶ä¸Šä¼ 
uni.addInterceptor("uploadFile", httpInterceptor); //ç›¸å½“äºæ‹¦æˆªæ‰€æœ‰çš„uni.uploadFile
```

å¸¸è§é—®é¢˜

**é—®:** ä¸ºä»€ä¹ˆç”¨æ‰‹æœºé¢„è§ˆæ²¡æœ‰æ•°æ®ï¼Ÿ

**ç­”:** å¾®ä¿¡å°ç¨‹åºç«¯ï¼Œéœ€ç™»å½• [å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/) é…ç½®ä»¥ä¸‹åœ°å€ä¸ºåˆæ³•åŸŸå ğŸ‘‡

```
https://pcapi-xiaotuxian-front-devtest.itheima.net
```

## 5.2 äºŒæ¬¡å°è£… request

utils/http/request.ts

```ts
import { checkStatus } from "./checlStatus";
import { useMemberStore } from "@/stores/modules/member";

const baseUrl = "https://pcapi-xiaotuxian-front-devtest.itheima.net";
// å°ç¨‹åºæ‹¦æˆªå™¨
const httpConfig = {
  //æ‹¦æˆªè¯·æ±‚
  invoke(options: UniApp.RequestOptions) {
    //é…ç½®baseurl
    if (!(options.url.startsWith("http") || options.url.startsWith("https"))) {
      options.url = baseUrl + options.url;
    }
    // è®¾ç½®è¶…æ—¶æ—¶é—´
    options.timeout = 5000;
    // è®¾ç½®è¯·æ±‚å¤´
    options.header = {
      "source-client": "miniapp",
      ...options.header,
    };
    //   è®¾ç½®token
    const memberStore = useMemberStore();
    const token = memberStore.profile?.token;
    if (token) {
      options.header.Authorization = token;
    }
    console.log("æ‹¦æˆªè¯·æ±‚", options);
  },
};

uni.addInterceptor("request", httpConfig); //æ‹¦æˆªæ‰€æœ‰çš„uni.request()
uni.addInterceptor("upload", httpConfig); //æ‹¦æˆªå°ç¨‹åºçš„uploadä¸Šä¼ 

// äºŒæ¬¡å°è£…
export interface Data<T> {
  code: string;
  msg: string;
  result: T;
}

export const http = <T>(options: UniApp.RequestOptions) => {
  return new Promise<Data<T>>((resolve, reject) => {
    uni.request({
      ...options,
      // å“åº”æˆåŠŸ
      success(res: UniApp.RequestSuccessCallbackResult) {
        if (res.statusCode >= 200 && res.statusCode <= 300) {
          resolve(res.data as Data<T>);
        } else {
          checkStatus(res.statusCode, (res.data as Data<T>).msg, reject, res);
        }
      },
      // å“åº”å¤±è´¥
      fail(err) {
        uni.showToast({
          icon: "none",
          title: "ç½‘ç»œé”™è¯¯ï¼Œæ¢ä¸ªç½‘ç»œè¯•è¯•",
        });
        reject(err);
      },
    });
  });
};
```

checkStatus.ts

```ts
import { useMemberStore } from "@/stores";
const memberStore = useMemberStore();

export function checkStatus(
  status: any,
  errmsg: string,
  reject: (reason?: any) => void,
  res: UniApp.RequestSuccessCallbackResult
) {
  let errMessage: string = `${errmsg || "è¯·æ±‚é”™è¯¯"}`;
  switch (status) {
    case 400:
      break;
    // 401
    case 401:
      errMessage = "tokenè¿‡æœŸ";
      memberStore.clearProfile();
      uni.navigateTo({ url: "/pages/login/login" });
      break;
    case 403:
      // errMessage = "403";
      break;
    // 404è¯·æ±‚ä¸å­˜åœ¨
    case 404:
      // errMessage = "è¯·æ±‚é¡µé¢ä¸å­˜åœ¨";
      break;
    case 405:
      // errMessage = "405";
      break;
    case 408:
      // errMessage = "408";
      break;
    case 500:
      // errMessage = "æœåŠ¡å™¨é”™è¯¯";
      break;
    case 501:
      // errMessage = "æœåŠ¡å™¨é”™è¯¯";
      break;
    case 502:
      // errMessage = "æœåŠ¡å™¨é”™è¯¯";
      break;
    case 503:
      // errMessage = "æœåŠ¡å™¨é”™è¯¯";
      break;
    case 504:
      // errMessage = "æœåŠ¡å™¨é”™è¯¯";
      break;
    case 505:
      // errMessage = "æœåŠ¡å™¨é”™è¯¯";
      break;
    default:
      errMessage = "æ— ç½‘ç»œ";
  }
  uni.showToast({
    icon: "none",
    title: errMessage,
  });
  reject(res);
}
```

# 6.ã€æ‹“å±•ã€‘ä»£ç è§„èŒƒ

**ä¸ºä»€ä¹ˆéœ€è¦ä»£ç è§„èŒƒ**

å¦‚æœæ²¡æœ‰ç»Ÿä¸€ä»£ç é£æ ¼ï¼Œå›¢é˜Ÿåä½œä¸ä¾¿äºæŸ¥çœ‹ä»£ç æäº¤æ—¶æ‰€åšçš„ä¿®æ”¹ã€‚

![diff](https://zongyan30.github.io/front-assets/å°å…”é²œ/index_picture_2.png)

### 6.1 ç»Ÿä¸€ä»£ç é£æ ¼ ESLint/Prettier

- å®‰è£… `eslint` + `prettier`

```sh
pnpm i -D eslint prettier eslint-plugin-vue @vue/eslint-config-prettier @vue/eslint-config-typescript @rushstack/eslint-patch @vue/tsconfig
```

- æ–°å»º `.eslintrc.cjs` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹ `eslint` é…ç½®

```js
/* eslint-env node */
require("@rushstack/eslint-patch/modern-module-resolution");

module.exports = {
  root: true,
  extends: [
    "plugin:vue/vue3-essential",
    "eslint:recommended",
    "@vue/eslint-config-typescript",
    "@vue/eslint-config-prettier",
  ],
  // å°ç¨‹åºå…¨å±€å˜é‡
  globals: {
    uni: true,
    wx: true,
    WechatMiniprogram: true,
    getCurrentPages: true,
    getApp: true,
    UniApp: true,
    UniHelper: true,
    App: true,
    Page: true,
    Component: true,
    AnyObject: true,
  },
  parserOptions: {
    ecmaVersion: "latest",
  },
  rules: {
    "prettier/prettier": [
      "warn",
      {
        singleQuote: true,
        semi: false,
        printWidth: 100,
        trailingComma: "all",
        endOfLine: "auto",
      },
    ],
    "vue/multi-word-component-names": ["off"],
    "vue/no-setup-props-destructure": ["off"],
    "vue/no-deprecated-html-element-is": ["off"],
    "@typescript-eslint/no-unused-vars": ["off"],
  },
};
```

- é…ç½® `package.json`

```json
{
  "script": {
    // ... çœç•¥ ...
    "lint": "eslint . --ext .vue,.js,.ts --fix --ignore-path .gitignore"
  }
}
```

- è¿è¡Œ

```sh
pnpm lint
```

::: tip æ¸©é¦¨æç¤º
åˆ°æ­¤ï¼Œä½ å·²å®Œæˆ `eslint` + `prettier` çš„é…ç½®ã€‚
:::

### 6.2 Git å·¥ä½œæµè§„èŒƒ--husky/lint-staged

- å®‰è£…å¹¶åˆå§‹åŒ– `husky`

::: code-group

```sh [pnpx]
pnpm dlx husky-init
```

```sh [npx]
npx husky-init
```

:::

- å®‰è£… `lint-staged`

```sh
pnpm i -D lint-staged
```

- é…ç½® `package.json`

```json
{
  "script": {
    // ... çœç•¥ ...
  },
  "lint-staged": {
    "*.{vue,ts,js}": ["eslint --fix"]
  }
}
```

- ä¿®æ”¹ `.husky/pre-commit` æ–‡ä»¶

```diff
npm test   // [!code --]
npm run lint-staged     // [!code ++]
```

::: tip æ¸©é¦¨æç¤º
åˆ°æ­¤ï¼Œä½ å·²å®Œæˆ `husky` + `lint-staged` çš„é…ç½®ã€‚
:::
